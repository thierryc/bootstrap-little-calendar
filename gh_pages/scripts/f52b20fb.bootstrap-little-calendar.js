!function(a){"use strict";var b=function(b,c){this.$element=a(b),this.options=c;var d='<div class="date-header"><div class="month"></div><div class="year"></div></div><table class="calendar"><thead class="calendar-header"></thead><tbody class="calendar-body"></tbody><tfoot><th colspan="2" data-calendar-action="prev"><div class="arrow"><i class="icon-arrow-left"></i></div></th><th colspan="3" data-calendar-action="current">%todayString%</th><th colspan="2" data-calendar-action="next"><div class="arrow"><i class="icon-arrow-right"></i></div></th></tfoot></table>';this.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31],this.weekStart=this.options.weekStart||1,this.weekEnd=0===this.weekStart?6:this.weekStart-1,this.days=this.options.days,this.months=this.options.months,this.todayString=this.options.todayString,this.events=this.options.events,this.calendar=a(d.replace("%todayString%",this.todayString)).appendTo(this.$element).on({click:a.proxy(this.click,this)}),this.date=this.options.date||new Date,this.init(this.date)};b.prototype={init:function(a){this.__renderDays(),this.__renderCalendar(a),this.$element.on("setEvents.calendar",function(a){this.setEvents(a)}),this.$element.on("next.calendar",this.next),this.$element.on("current.calendar",this.current),this.$element.on("prev.calendar",this.prev)},__renderCalendar:function(a){this.year=a.getFullYear(),this.month=a.getMonth();var b=this.year,c=this.month,d=new Date,e=new Date(b,c-1,28,0,0,0,0),f=new Date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0,0);this.daysInMonth[1]=this.__isLeapYear(b)?29:28;var g=this.daysInMonth[e.getMonth()];e.setDate(g),e.setDate(g-(e.getDay()-this.weekStart+7)%7);var h=e.getDay(),i=e.getDate(),j=e.getFullYear(),k=e.getMonth(),l=new Date(e);l.setDate(e.getDate()+42);var m=[],n="",o="";for(this.$element.find(".year").empty().append(b),this.$element.find(".month").empty().append(this.months[c]);e.valueOf()<l.valueOf();)h=e.getDay(),i=e.getDate(),j=e.getFullYear(),k=e.getMonth(),n="",e.getDay()===this.weekStart&&m.push("<tr>"),n+=c>k&&j===b||b>j?" old":k>c&&j===b||j>b?" new":" day",(h%7===0||h%7===6)&&(n+=" weekend"),e.valueOf()===f.valueOf()&&(n+=" today"),o=j+"-"+(k+1)+"-"+("0"+i).slice(-2),m.push('<td class="apbscalendar_'+o+n+'" data-year="'+j+'" data-month="'+(k+1)+'" data-day="'+i+'"><span>'+i+"</span></td>"),e.getDay()===this.weekEnd&&m.push("</tr>"),e.setDate(e.getDate()+1);this.$element.find(".calendar-body").empty().append(m.join("")),this.loadEvents()},__renderDays:function(){for(var a="",b=this.weekStart;b<this.weekStart+7;b++)a+="<th>"+this.days[b%7]+"</th>";a="<tr>"+a+"</tr>",this.$element.find(".calendar-header").empty().append(a)},__renderEvents:function(b){var c=this;a.each(b.event,function(){console.log(this.date);var a=new Date(this.date);a.getFullYear()===c.year&&a.getMonth()===c.month&&c.$element.find("td.apbscalendar_"+this.date).addClass("event")})},__isLeapYear:function(a){return a%4===0&&a%100!==0||a%400===0},getActiveMonth:function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},setEvents:function(){},click:function(b){b.stopPropagation(),b.preventDefault();var c=a(b.target).closest("td, th");if(1===c.length)switch(c[0].nodeName.toLowerCase()){case"th":switch(a(c[0]).data("calendarAction")){case"prev":this.prev(a(c[0]));break;case"current":this.current(a(c[0]));break;case"next":this.next(a(c[0]))}break;case"td":console.log(a(c[0]).data())}},prev:function(b){var c=a(b).data();c.type="onPrev",this.$element.trigger(c),this.__renderCalendar(new Date(this.year,this.month-1,1))},current:function(b){var c=a(b).data();c.type="onCurrent",this.$element.trigger(c),this.__renderCalendar(new Date)},next:function(b){var c=a(b).data();c.type="onNext",this.$element.trigger(c),this.__renderCalendar(new Date(this.year,this.month+1,1))},loadEvents:function(){null!==this.events&&"function"==typeof this.events&&this.__renderEvents(this.events.apply(this,[]))}};var c=a.fn.calendar;a.fn.calendar=function(c){return this.each(function(){var d=a(this),e=d.data("calendar"),f=a.extend({},a.fn.calendar.defaults,"object"==typeof c&&c);e||d.data("calendar",e=new b(this,f))})},a.fn.calendar.defaults={weekStart:1,days:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],todayString:"Today",events:null},a.fn.calendar.Constructor=b,a.fn.calendar.noConflict=function(){return a.fn.calendar=c,this},a(document).on("click.calendar.data-api","[data-calendar-next], [data-calendar-back]",function(b){var c,d=a(this),e=a(d.attr("data-target")||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"")),f=a.extend({},e.data(),d.data());e.calendar(f),b.preventDefault()})}(window.jQuery);